<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Collisions in Seattle 2025</title>

    <!-- Mapbox CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />

    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }

                /* the style of the layer control menu */
        #menu {
            background: #fff;
            position: absolute;
            z-index: 1;
            top: 10px;
            right: 10px;
            border-radius: 3px;
            width: 120px;
            border: 1px solid rgba(0, 0, 0, 0.4);
            font-family: 'Open Sans', sans-serif;
        }

        /* each layer on the menu */
        #menu a {
            font-size: 13px;
            color: #404040;
            display: block;
            margin: 0;
            padding: 0;
            padding: 10px;
            text-decoration: none;
            border-bottom: 1px solid rgba(0, 0, 0, 0.25);
            text-align: center;
        }

        /* the last item of the layer items will not include a seperator */
        #menu a:last-child {
            border: none;
        }

        /* change color and background color while a pointer is on an hybrid link. */
        #menu a:hover {
            background-color: #f8f8f8;
            color: #404040;
        }

        #menu a.active {
            background-color: #3887be;
            color: #ffffff;
        }

        #menu a.active:hover {
            background: #3074a4;
        }


        .map-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            background: rgba(255, 255, 255, 0.8);
            border-style: solid;
            border-width: 1px;
            border-color: rgba(0, 0, 0, 0.2);
            margin-left: 20px;
            font-family: Arial, sans-serif;
            overflow: auto;
            border-radius: 3px;
        }
    </style>
</head>







<body>
    <div id="map"></div>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <nav id="menu"></nav>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibnVnYWl5ZW4iLCJhIjoiY21rb29tNzZxMDMzYTNmcHBpYmlkZGJqNSJ9.aa6QqHmav1QDW8cZUNCBhw';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/nugaiyen/cml92lcc3006601sqbrh593sz',
            center: [-122.39, 47.61], // Seattle
            zoom: 10.3
        });


        map.on('load', async () => {
                
            // Add GeoJSON source
            map.addSource(
                '2025polygon-data',{
                    type: 'geojson', 
                    data: 'assets/polygonCount2025.geojson'
                }
            );

        
            map.addLayer({ // Add choropleth layer
                id: 'polygon-counts',
                type: 'fill',
                source: '2025polygon-data',
                paint: {
                    'fill-color': [
                        'interpolate',
                        ['linear'],
                        ['get', 'count'],
                        6, '#FFEDA0',    // min
                        38, '#FED976',   // median
                        68, '#FEB24C',
                        94, '#FD8D3C',
                        191, '#E31A1C'   // max
                    ],
                    'fill-outline-color': '#36454F',
                    'fill-opacity': 0.7
                    
                } // paint
            }); // add choropleth layer 


            map.addSource('points-data', { 
                type: 'geojson',
                data: 'assets/points2025.geojson'
            });

            map.addLayer({
                'id': 'points',
                'type': 'circle',
                'layout': {'visibility': 'none'},
                'source': 'points-data',
                paint: {      
                    'circle-color': '#E31A1C',           // fill color
                    'circle-stroke-width': 1,
                    'circle-opacity': 0.7,
                    'circle-radius': 5 
                }
                
            });

                map.on('click', 'polygon-counts', (event) => {
                new mapboxgl.Popup()
                .setLngLat(event.lngLat)
                .setHTML(
                    `<strong>Neighborhood:</strong> ${event.features[0].properties.S_HOOD}<br>
                    <strong>Counts:</strong> ${event.features[0].properties.count}`
                )
                .addTo(map);
            }); // on click 

            map.on('idle', () => {
                // Only run if the layer exists
                if (!map.getLayer('points')) return;

                const toggleableLayerIds = ['points']; // use actual layer id

                for (const id of toggleableLayerIds) {
                    if (document.getElementById(id)) continue;

                    const link = document.createElement('a');
                    link.id = id;
                    link.href = '#';
                    link.textContent = 'Show individual points'; // button text
                    link.className = 'inactive';

                    link.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();

                        const visibility = map.getLayoutProperty(id, 'visibility');

                        if (visibility === 'visible') {
                            map.setLayoutProperty(id, 'visibility', 'none');
                            this.className = 'inactive';
                        } else {
                            map.setLayoutProperty(id, 'visibility', 'visible');
                            this.className = 'active';
                        }
                    };

                    document.getElementById('menu').appendChild(link);
                }
            });







            
      



            
        }); // on load 
        
    </script>

</body>
</html>